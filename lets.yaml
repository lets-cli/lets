shell: bash

env:
  DOCKER_BUILDKIT: "1"

commands:
  version:
    description: Update version.go file with latest tag
    options: |
      Usage: lets version <version>
      Options:
        <version>   Set version
    cmd: |
      sed -i -E "s/var version = \".*\"/var version = \"${LETSOPT_VERSION}\"/g" version.go

  build-docker:
    cmd: docker build -t lets -f docker/Dockerfile .

  test:
    description: Run tests for lets
    depends: [build-docker]
    cmd:
      docker-compose run --rm test

  staticcheck:
    description: Run staticcheck for lets
    depends: [build-docker]
    cmd:
      docker-compose run --rm staticheck

  fmt:
    description: Run sfmt
    cmd:
      go fmt ./...