shell: bash

commands:
  test-options:
    description: Test options
    options: |
      Usage:
        lets test-options [--kv-opt=<kv-opt>] [--bool-opt] [--attr=<attr>...] [<args>...]

      Options:
        <args>...                Positional args in the end
        --bool-opt, -b           Boolean opt
        --kv-opt=<kv-opt>, -K    Key value opt
        --attr=<attr>...         Repeated kv args
    cmd: |
      echo "Flags command"
      echo LETSOPT_KV_OPT=${LETSOPT_KV_OPT}
      echo LETSOPT_BOOL_OPT=${LETSOPT_BOOL_OPT}
      echo LETSOPT_ARGS=${LETSOPT_ARGS}
      echo LETSOPT_ATTR=${LETSOPT_ATTR}
      echo LETSCLI_KV_OPT=${LETSCLI_KV_OPT}
      echo LETSCLI_BOOL_OPT=${LETSCLI_BOOL_OPT}
      echo LETSCLI_ARGS=${LETSCLI_ARGS}
      echo LETSCLI_ATTR=${LETSCLI_ATTR}

  test-env:
    description: Test env
    env:
      MY_ENV: "my env val"
    cmd: echo ${LETSOPT_MY_ENV}

  test-eval_env:
    description: Test eval_env
    eval_env:
      CHECKSUM: echo "evaled_checksum"

  test-depends:
    description: Test depends
    depends:
      - test-env
      - test-eval_env

  test-cmd-as-list:
    description: Test cmd as list
    cmd:
      - echo
      - test
      - cmd

  test-checksum:
    description: test checksum
    checksum:
      - README.md
      - LICENSE
    cmd:
      - echo
      - "${LETS_CHECKSUM}"

  version:
    description: Update version.go file with latest tag
    options: |
      Usage: lets version <version>
      Options:
        <version>   Set version
    cmd: |
      sed -i -E "s/var version = \".*\"/var version = \"${LETSOPT_VERSION}\"/g" version.go

  test:
    description: Run tests for lets
    cmd:
      docker-compose run --rm test

  staticcheck:
    description: Run staticcheck for lets
    cmd:
      docker-compose run --rm staticheck

  fmt:
    description: Run sfmt
    cmd:
      go fmt ./...