"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[446],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return u}});var l=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,l,a=function(e,n){if(null==e)return{};var t,l,a={},i=Object.keys(e);for(l=0;l<i.length;l++)t=i[l],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)t=i[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=l.createContext({}),s=function(e){var n=l.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},m=function(e){var n=s(e.components);return l.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},c=l.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),c=s(t),u=a,k=c["".concat(p,".").concat(u)]||c[u]||d[u]||i;return t?l.createElement(k,r(r({ref:n},m),{},{components:t})):l.createElement(k,r({ref:n},m))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=c;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,r[1]=o;for(var s=2;s<i;s++)r[s]=t[s];return l.createElement.apply(null,r)}return l.createElement.apply(null,t)}c.displayName="MDXCreateElement"},5142:function(e,n,t){t.r(n),t.d(n,{assets:function(){return m},contentTitle:function(){return p},default:function(){return u},frontMatter:function(){return o},metadata:function(){return s},toc:function(){return d}});var l=t(7462),a=t(3366),i=(t(7294),t(3905)),r=["components"],o={id:"config",title:"Config reference"},p=void 0,s={unversionedId:"config",id:"config",title:"Config reference",description:"* shell",source:"@site/docs/config.md",sourceDirName:".",slug:"/config",permalink:"/docs/config",draft:!1,editUrl:"https://github.com/lets-cli/lets/edit/master/docs/docs/config.md",tags:[],version:"current",frontMatter:{id:"config",title:"Config reference"},sidebar:"someSidebar",previous:{title:"Advanced usage",permalink:"/docs/advanced_usage"},next:{title:"CLI options",permalink:"/docs/cli"}},m={},d=[{value:"Top-level directives:",id:"top-level-directives",level:2},{value:"Version",id:"version",level:3},{value:"Shell",id:"shell",level:3},{value:"Global env",id:"global-env",level:3},{value:"Global eval_env",id:"global-eval_env",level:3},{value:"Global before",id:"global-before",level:3},{value:"Global init",id:"global-init",level:3},{value:"Mixins",id:"mixins",level:3},{value:"Ignored mixins",id:"ignored-mixins",level:3},{value:"Remote mixins <code>(experimental)</code>",id:"remote-mixins-experimental",level:3},{value:"Commands",id:"commands",level:3},{value:"Command directives:",id:"command-directives",level:2},{value:"Short syntax",id:"short-syntax",level:3},{value:"<code>cmd</code>",id:"cmd",level:3},{value:"<code>description</code>",id:"description",level:3},{value:"<code>work_dir</code>",id:"work_dir",level:3},{value:"<code>shell</code>",id:"shell-1",level:3},{value:"<code>after</code>",id:"after",level:3},{value:"<code>depends</code>",id:"depends",level:3},{value:"Override arguments in depends command",id:"override-arguments-in-depends-command",level:4},{value:"<code>options</code>",id:"options",level:3},{value:"<code>env</code>",id:"env",level:3},{value:"<code>eval_env</code>",id:"eval_env",level:3},{value:"<code>checksum</code>",id:"checksum",level:3},{value:"<code>persist_checksum</code>",id:"persist_checksum",level:3},{value:"<code>ref</code>",id:"ref",level:3},{value:"<code>args</code>",id:"args",level:3}],c={toc:d};function u(e){var n=e.components,t=(0,a.Z)(e,r);return(0,i.kt)("wrapper",(0,l.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#shell"},"shell")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#mixins"},"mixins")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#global-env"},"env")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#global-eval_env"},"eval_env")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#init"},"init")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#before"},"before")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#commands"},"commands"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#description"},"description")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#cmd"},"cmd")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#work_dir"},"work_dir")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#after"},"after")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#depends"},"depends")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#options"},"options")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#env"},"env")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#eval_env"},"eval_env")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#checksum"},"checksum")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#persist_checksum"},"persist_checksum")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#ref"},"ref")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#args"},"args"))))),(0,i.kt)("h2",{id:"top-level-directives"},"Top-level directives:"),(0,i.kt)("h3",{id:"version"},"Version"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: version")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: semver string")),(0,i.kt)("p",null,"Specify ",(0,i.kt)("strong",{parentName:"p"},"minimum required")," ",(0,i.kt)("inlineCode",{parentName:"p"},"lets")," version to run this config."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"version: '0.0.20'\n")),(0,i.kt)("h3",{id:"shell"},"Shell"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: shell")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"required: true")),(0,i.kt)("p",null,"Specify shell to use when running commands"),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"shell: bash\n")),(0,i.kt)("h3",{id:"global-env"},"Global env"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: env")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: map string => string or map with execution mode")),(0,i.kt)("p",null,"Specify global env for all commands."),(0,i.kt)("p",null,"Env can be declared as static value or with execution mode:"),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'shell: bash\nenv:\n  MY_GLOBAL_ENV: "123"\n  MY_GLOBAL_ENV_2: \n    sh: echo "`id`"\n  MY_GLOBAL_ENV_3:\n    checksum: [Readme.md, package.json]\n')),(0,i.kt)("h3",{id:"global-eval_env"},"Global eval_env"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"Deprecated"))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: eval_env")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: mapping string => string")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Since ",(0,i.kt)("inlineCode",{parentName:"p"},"env")," now has ",(0,i.kt)("inlineCode",{parentName:"p"},"sh")," execution mode, ",(0,i.kt)("inlineCode",{parentName:"p"},"eval_env")," is deprecated.")),(0,i.kt)("p",null,"Specify global eval_env for all commands."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'shell: bash\neval_env:\n  CURRENT_UID: echo "`id -u`:`id -g`"\n')),(0,i.kt)("h3",{id:"global-before"},"Global before"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: before")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string")),(0,i.kt)("p",null,"Specify global before script for all commands."),(0,i.kt)("p",null,"A script from ",(0,i.kt)("inlineCode",{parentName:"p"},"before")," will be prepended to each command's script."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Be carefull to not execute some heavy commands in before as it will be executed cmd + depends (recursively) times.")),(0,i.kt)("p",null,"Lets say, we want set log ",(0,i.kt)("inlineCode",{parentName:"p"},"level")," for all docker-compose calls."),(0,i.kt)("p",null,"In the example below, we overriding ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose")," with an ",(0,i.kt)("em",{parentName:"p"},"alias")," which has log level set to ",(0,i.kt)("inlineCode",{parentName:"p"},"ERROR")," by default."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"If you need to run a script at lets startup only once - use ",(0,i.kt)("inlineCode",{parentName:"p"},"init")," deirective instead")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"shell: bash\n\nbefore:\n  function docker-compose() {\n    docker-compose --log-level ERROR $@\n  }\n\n  export XXX=123\n\ncommands:\n  redis: |\n    echo $XXX\n    docker-compose up redis\n")),(0,i.kt)("h3",{id:"global-init"},"Global init"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: init")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string")),(0,i.kt)("p",null,"Specify init script which will be executed only once. It is execured right before first command call."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"init")," script is a good place for some intialization that sould be done once, for example,"),(0,i.kt)("p",null,"create docker network, check if some directory exist, clear caches, etc."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"shell: bash\n\ninit: |\n  echo From init\n\nbefore: |\n  echo From before\n\ncommands:\n  foo: echo Foo\n  bar: \n    depends: [foo]\n    cmd: echo Bar\n")),(0,i.kt)("p",null,"Calling ",(0,i.kt)("inlineCode",{parentName:"p"},"lets bar")," will print:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"From init\nFrom before\nFoo\nFrom before\nBar\n")),(0,i.kt)("h3",{id:"mixins"},"Mixins"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: mixins")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type:")," "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"list of strings")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"list of map"))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Example")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"mixins:\n  - lets.build.yaml\n  - url: https://raw.githubusercontent.com/lets-cli/lets/master/lets.build.yaml\n    version: 1\n")),(0,i.kt)("p",null,"Allows to split ",(0,i.kt)("inlineCode",{parentName:"p"},"lets.yaml")," into mixins (mixin config files)."),(0,i.kt)("p",null,"To make ",(0,i.kt)("inlineCode",{parentName:"p"},"lets.yaml")," small and readable it is convenient to split main config into many smaller ones and include them"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Full example")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"# in lets.yaml\n...\nshell: bash\nmixins:\n  - test.yaml\n\ncommands:\n  echo:\n    cmd: echo Hi\n    \n# in test.yaml\n...\ncommands:\n  test:\n    cmd: echo Testing...\n")),(0,i.kt)("h3",{id:"ignored-mixins"},"Ignored mixins"),(0,i.kt)("p",null,"It is possible to specify mixin file which could not exist. It is convenient when you have\ngit-ignored file where you write your own commands."),(0,i.kt)("p",null,"To make ",(0,i.kt)("inlineCode",{parentName:"p"},"lets")," read this mixin just add ",(0,i.kt)("inlineCode",{parentName:"p"},"-")," prefix to filename"),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"shell: bash\nmixins:\n  - -my.yaml\n")),(0,i.kt)("p",null,"Now if ",(0,i.kt)("inlineCode",{parentName:"p"},"my.yaml")," exists - it will be loaded as a mixin. If it is not exist - ",(0,i.kt)("inlineCode",{parentName:"p"},"lets")," will skip it."),(0,i.kt)("h3",{id:"remote-mixins-experimental"},"Remote mixins ",(0,i.kt)("inlineCode",{parentName:"h3"},"(experimental)")),(0,i.kt)("p",null,"It is possible to specify mixin as url. Lets will download it and load it as a mixin.\nFile will be stored in ",(0,i.kt)("inlineCode",{parentName:"p"},".lets/mixins")," directory."),(0,i.kt)("p",null,"By default mixin filename will be sha256 hash of url."),(0,i.kt)("p",null,"You can specify ",(0,i.kt)("inlineCode",{parentName:"p"},"version")," key. If url is not versioned, lets will use ",(0,i.kt)("inlineCode",{parentName:"p"},"version")," for filename hash as well (",(0,i.kt)("inlineCode",{parentName:"p"},"hash(url) + hash(version)"),")."),(0,i.kt)("p",null,"For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"shell: bash\nmixins:\n  - url: https://raw.githubusercontent.com/lets-cli/lets/master/lets.build.yaml\n    version: 1\n")),(0,i.kt)("h3",{id:"commands"},"Commands"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: commands")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: mapping")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"required: true")),(0,i.kt)("p",null,"Mapping of all available commands"),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  test:\n    description: Test something\n")),(0,i.kt)("h2",{id:"command-directives"},"Command directives:"),(0,i.kt)("h3",{id:"short-syntax"},"Short syntax"),(0,i.kt)("p",null,"Command can be written using short syntax:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  test: npm run test\n")),(0,i.kt)("p",null,"Alternatively command can be declared using the following directives:"),(0,i.kt)("h3",{id:"cmd"},(0,i.kt)("inlineCode",{parentName:"h3"},"cmd")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: cmd")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"type: \n  - string\n  - array of strings\n  - map of string => string (experimental)\n")),(0,i.kt)("p",null,"Actual command to run in shell."),(0,i.kt)("p",null,"Can be either:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"a string (also a multiline string)"),(0,i.kt)("li",{parentName:"ul"},"an array of strings - it will allow to append all arguments passed to command as is (see bellow)"),(0,i.kt)("li",{parentName:"ul"},"a map of string => string - this will allow run commands in parallel ",(0,i.kt)("inlineCode",{parentName:"li"},"(experimental)"))),(0,i.kt)("p",null,"Example single string:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  test:\n    description: Test something\n    cmd: go test ./... -v\n")),(0,i.kt)("p",null,"Example multiline string:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'commands:\n  test:\n    description: Test something\n    cmd: |\n      echo "Running go tests..."\n      go test ./... -v\n')),(0,i.kt)("p",null,"Example array of strings:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  test:\n    description: Test something\n    cmd: \n      - go\n      - test\n      - ./...\n")),(0,i.kt)("p",null,"When run with cmd as array of strings:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"lets test -v\n")),(0,i.kt)("p",null,"the ",(0,i.kt)("inlineCode",{parentName:"p"},"-v")," will be appended, so the resulting command to run will be ",(0,i.kt)("inlineCode",{parentName:"p"},"go test ./... -v")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"cmd")," can be a map ",(0,i.kt)("inlineCode",{parentName:"p"},"(it is experimental feature)"),"."),(0,i.kt)("p",null,"Example of map of string => string"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  run:\n    description: Test something\n    cmd: \n      app: npm run app\n      nginx: docker-compose up nginx\n      redis: docker-compsoe up redis\n")),(0,i.kt)("p",null,"There are two flags ",(0,i.kt)("inlineCode",{parentName:"p"},"--only")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"--exclude")," you can use with cmd map."),(0,i.kt)("p",null,"There must be used before command name:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"lets --only app run\n")),(0,i.kt)("h3",{id:"description"},(0,i.kt)("inlineCode",{parentName:"h3"},"description")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: description")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string")),(0,i.kt)("p",null,"Short description of command - shown in help message"),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  test:\n    description: Test something\n")),(0,i.kt)("h3",{id:"work_dir"},(0,i.kt)("inlineCode",{parentName:"h3"},"work_dir")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: work_dir")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string")),(0,i.kt)("p",null,"Specify work directory to run in. Path must be relative to project root. Be default command's workdir is project root (where lets.yaml located)."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  run-docs:\n    description: Run docusaurus documentation live\n    work_dir: docs\n    cmd: npm start\n")),(0,i.kt)("h3",{id:"shell-1"},(0,i.kt)("inlineCode",{parentName:"h3"},"shell")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: shell")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string")),(0,i.kt)("p",null,"Specify shell to run command in."),(0,i.kt)("p",null,"Any shell can be used, not only sh-compatible, for example ",(0,i.kt)("inlineCode",{parentName:"p"},"python"),"."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"shell: bash\ncommands:\n  run-sh:\n    shell: /bin/sh\n    cmd: echo Hi\n    \n  run-py:\n    shell: python\n    cmd: print('hi')\n")),(0,i.kt)("h3",{id:"after"},(0,i.kt)("inlineCode",{parentName:"h3"},"after")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: after")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string")),(0,i.kt)("p",null,"Specify script to run after the actual command. May be useful, when we want to cleanup some resources or stop some services"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"after")," script is guaranteed to execute if specified, event if ",(0,i.kt)("inlineCode",{parentName:"p"},"cmd")," exit code is not ",(0,i.kt)("inlineCode",{parentName:"p"},"0")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  redis:\n    description: Run redis\n    cmd: docker-compose up redis\n    after: docker-compose stop redis\n\n  run:\n    description: Run app and services\n    cmd: \n      app: node server.js\n      redis: docker-compose up redis\n    after: |\n      echo Stopping app and redis\n      docker-compose stop redis\n")),(0,i.kt)("h3",{id:"depends"},(0,i.kt)("inlineCode",{parentName:"h3"},"depends")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: depends")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: array of string or array or object")),(0,i.kt)("p",null,"Specify what commands to run before the actual command. May be useful, when you have one shared command.\nFor example, lets say you have command ",(0,i.kt)("inlineCode",{parentName:"p"},"build"),", which builds docker image."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  build:\n    description: Build docker image\n    cmd: docker build -t myimg . -f Dockerfile\n\n  test:\n    description: Test something\n    depends: [build]\n    cmd: go test ./... -v\n\n  fmt:\n    description: Format the code\n    depends: [build]\n    cmd: go fmt\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"build")," command will be executed each time you run ",(0,i.kt)("inlineCode",{parentName:"p"},"lets test")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"lets fmt")),(0,i.kt)("h4",{id:"override-arguments-in-depends-command"},"Override arguments in depends command"),(0,i.kt)("p",null,"It is possible to override arguments or env for any commands declared in depends."),(0,i.kt)("p",null,"For example we want:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"build")," command to be executed with ",(0,i.kt)("inlineCode",{parentName:"li"},"--verbose")," flag in test ",(0,i.kt)("inlineCode",{parentName:"li"},"depends"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"alarm")," command to be executed with ",(0,i.kt)("inlineCode",{parentName:"li"},"Something is happening")," arg and ",(0,i.kt)("inlineCode",{parentName:"li"},"LEVEL: INFO")," env in test ",(0,i.kt)("inlineCode",{parentName:"li"},"depends"),".")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  greet:\n    cmd: echo Hi developer\n\n  alarm:\n    options: |\n      Usage: lets alarm <msg>\n    env:\n      LEVEL: DEBUG\n    cmd: echo Alarm ${LETSOPT_MSG}\n\n  build:\n    description: Build docker image\n    options: |\n      lets build [--verbose]\n    cmd: |\n      if [[ -n ${LETSOPT_VERBOSE} ]]; then\n        echo Building docker image\n      fi\n      docker build -t myimg . -f Dockerfile\n\n  test:\n    description: Test something\n    depends:\n      - greet\n      - name: alarm\n        args: Something is happening\n        env:\n          LEVEL: INFO\n      - name: build:\n        args: [--verbose]\n    cmd: go test ./... -v\n")),(0,i.kt)("p",null,"Running ",(0,i.kt)("inlineCode",{parentName:"p"},"lets test")," will output: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# lets test\n# Hi developer\n# Something is happening\n# Building docker image\n# ... continue building docker image\n")),(0,i.kt)("h3",{id:"options"},(0,i.kt)("inlineCode",{parentName:"h3"},"options")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: options")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string (multiline string)")),(0,i.kt)("p",null,"One of the most cool things about ",(0,i.kt)("inlineCode",{parentName:"p"},"lets")," than it has built in docopt parsing.\nAll you need is to write a valid docopt for a command and lets will parse and inject all values for you."),(0,i.kt)("p",null,"More info ",(0,i.kt)("a",{parentName:"p",href:"http://docopt.org"},"http://docopt.org")),(0,i.kt)("p",null,"When parsed, ",(0,i.kt)("inlineCode",{parentName:"p"},"lets")," will provide two kind of env variables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LETSOPT_<VAR>")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LETSCLI_<VAR>"))),(0,i.kt)("p",null,"How does it work?"),(0,i.kt)("p",null,"Lets see an example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  echo-env:\n    description: Echo env vars\n    options:\n      Usage: lets [--log-level=<level>] [--debug] <args>...\n      Options:\n        <args>...       List of required positional args\n        --log-level,-l      Log level\n        --debug,-d      Run with debug\n    cmd: |\n      echo ${LETSOPT_ARGS}\n      app ${LETSCLI_DEBUG}\n")),(0,i.kt)("p",null,"So here we have:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"args")," - is a list of required positional args"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"--log-level")," - is a key-value flag, must be provided with some value"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"--debug")," - is a bool flag, if specified, means true, if no specified means false"),(0,i.kt)("p",null,"In the env of ",(0,i.kt)("inlineCode",{parentName:"p"},"cmd")," command there will be available two types of env variables:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"lets echo-env --log-level=info --debug one two three")),(0,i.kt)("p",null,"Parsed and formatted key values"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"echo LETSOPT_ARGS=${LETSOPT_ARGS} # LETSOPT_ARGS=one two three\necho LETSOPT_LOG_LEVEL=${LETSOPT_LOG_LEVEL} # LETSOPT_LOG_LEVEL=info\necho LETSOPT_DEBUG=${LETSOPT_DEBUG} # LETSOPT_DEBUG=true\n")),(0,i.kt)("p",null,"Raw flags (useful if for example you want to pass ",(0,i.kt)("inlineCode",{parentName:"p"},"--debug")," as is)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"echo LETSCLI_ARGS=${LETSCLI_ARGS} # LETSCLI_ARGS=one two three\necho LETSCLI_LOG_LEVEL=${LETSCLI_LOG_LEVEL} # LETSCLI_LOG_LEVEL=--log-level info\necho LETSCLI_DEBUG=${LETSCLI_DEBUG} # LETSCLI_DEBUG=--debug\n")),(0,i.kt)("h3",{id:"env"},(0,i.kt)("inlineCode",{parentName:"h3"},"env")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: env")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: mapping string => string or map with execution mode")),(0,i.kt)("p",null,"Env is as simple as it sounds. Define additional env for a command: "),(0,i.kt)("p",null,"Env can be declared as static value or with execution mode:"),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'commands:\n  test:\n    description: Test something\n    env:\n      GO111MODULE: "on"\n      GOPROXY: https://goproxy.io\n      MY_ENV_1:\n        sh: echo "`id`"\n      MY_ENV_2:\n        checksum: [Readme.md, package.json]\n    cmd: go build -o lets *.go\n')),(0,i.kt)("h3",{id:"eval_env"},(0,i.kt)("inlineCode",{parentName:"h3"},"eval_env")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"Deprecated"))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: eval_env")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: mapping string => string")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Since ",(0,i.kt)("inlineCode",{parentName:"p"},"env")," now has ",(0,i.kt)("inlineCode",{parentName:"p"},"sh")," execution mode, ",(0,i.kt)("inlineCode",{parentName:"p"},"eval_env")," is deprecated.")),(0,i.kt)("p",null,"Same as env but allows you to dynamically compute env:"),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'commands:\n  test:\n    description: Test something\n    eval_env:\n      CURRENT_UID: echo "`id -u`:`id -g`"\n      CURRENT_USER_NAME: echo "`id -un`"\n    cmd: go build -o lets *.go\n')),(0,i.kt)("p",null,"Value will be executed in shell and result will be saved in env."),(0,i.kt)("h3",{id:"checksum"},(0,i.kt)("inlineCode",{parentName:"h3"},"checksum")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: checksum")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: array of string | mapping string => array of string")),(0,i.kt)("p",null,"Checksum used for computing file hashes. It is useful when you depend on some files content changes."),(0,i.kt)("p",null,"In ",(0,i.kt)("inlineCode",{parentName:"p"},"checksum")," you can specify:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"a list of file names "),(0,i.kt)("li",{parentName:"ul"},"a list of file regexp patterns (parsed via go ",(0,i.kt)("inlineCode",{parentName:"li"},"path/filepath.Glob"),")")),(0,i.kt)("p",null,"or"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"a mapping where key is name of env variable and value is:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"a list of file names "),(0,i.kt)("li",{parentName:"ul"},"a list of file regexp patterns (parsed via go ",(0,i.kt)("inlineCode",{parentName:"li"},"path/filepath.Glob"),")")))),(0,i.kt)("p",null,"Each time a command runs, ",(0,i.kt)("inlineCode",{parentName:"p"},"lets")," will calculate the checksum of all files specified in ",(0,i.kt)("inlineCode",{parentName:"p"},"checksum"),"."),(0,i.kt)("p",null,"Result then can be accessed via ",(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM")," env variable."),(0,i.kt)("p",null,"If checksum is a mapping, e.g:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  build:\n    checksum:\n      deps:\n        - package.json\n      doc:\n        - Readme.md\n")),(0,i.kt)("p",null,"Resulting env will be:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LETS_CHECKSUM_DEPS")," - checksum of deps files"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LETS_CHECKSUM_DOC")," - checksum of doc files"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LETS_CHECKSUM")," - checksum of all checksums (deps and doc)")),(0,i.kt)("p",null,"Checksum is calculated with ",(0,i.kt)("inlineCode",{parentName:"p"},"sha1"),"."),(0,i.kt)("p",null,"If you specify patterns, ",(0,i.kt)("inlineCode",{parentName:"p"},"lets")," will try to find all matches and will calculate checksum of that files."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"shell: bash\ncommands:\n  app-build:\n    checksum: \n      - requirements-*.txt\n    cmd: |\n      docker pull myrepo/app:${LETS_CHECKSUM}\n      docker run --rm myrepo/app${LETS_CHECKSUM} python -m app       \n")),(0,i.kt)("h3",{id:"persist_checksum"},(0,i.kt)("inlineCode",{parentName:"h3"},"persist_checksum")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: persist_checksum")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: bool")),(0,i.kt)("p",null,"This feature is useful when you want to know that something has changed between two executions of a command."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"persist_checksum")," can be used only if ",(0,i.kt)("inlineCode",{parentName:"p"},"checksum")," declared for command."),(0,i.kt)("p",null,"If set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),", each run all calculated checksums will be stored to disk."),(0,i.kt)("p",null,"After each subsequent run ",(0,i.kt)("inlineCode",{parentName:"p"},"lets")," will check if new checksum and stored checksum are different."),(0,i.kt)("p",null,"Result of that check will be exposed via ",(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM_CHANGED")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM_[checksum-name]_CHANGED")," env variables. "),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"IMPORTANT"),": New checksum will override old checksum only if cmd has exit code ",(0,i.kt)("strong",{parentName:"p"},"0")," "),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM_CHANGED")," will be true after the very first execution, because when you first run command, there is no checksum yet, so we are calculating new checksum - that means that checksum has changed."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  build:\n    persist_checksum: true\n    checksum:\n      deps:\n        - package.json\n      doc:\n        - Readme.md\n")),(0,i.kt)("p",null,"Resulting env will be:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM_DEPS")," - checksum of deps files")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM_DOC")," - checksum of doc files")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM")," - checksum of all checksums (deps and doc)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM_DEPS_CHANGED")," - is checksum of deps files changed")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM_DOC_CHANGED")," - is checksum of doc files changed")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"LETS_CHECKSUM_CHANGED")," - is checksum of all checksums (deps and doc) changed"))),(0,i.kt)("h3",{id:"ref"},(0,i.kt)("inlineCode",{parentName:"h3"},"ref")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: ref")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"Experimental feature"))),(0,i.kt)("p",null,"NOTE: ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," is not compatible (yet) with any directives except ",(0,i.kt)("inlineCode",{parentName:"p"},"args"),". Actually ",(0,i.kt)("inlineCode",{parentName:"p"},"ref")," is a special syntax that turns command into reference to command. It may be changed in the future."),(0,i.kt)("p",null,"Allows to run command with predefined arguments. Before this was implemented, if you had some commmand and wanted same command but with some predefined args, you had to use so called ",(0,i.kt)("inlineCode",{parentName:"p"},"lets-in-lets")," hack."),(0,i.kt)("p",null,"Before:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  ls:\n    cmd: [ls]\n\n  ls-table:\n    cmd: lets ls -l\n")),(0,i.kt)("p",null,"Now:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"commands:\n  hello:\n    cmd: echo Hello $@\n\n  hello-world:\n    ref: hello\n    args: World\n\n  hello-by-name:\n    ref: hello\n    args: [Dear, Friend]\n")),(0,i.kt)("h3",{id:"args"},(0,i.kt)("inlineCode",{parentName:"h3"},"args")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"key: args")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type: string or list of string")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"Experimental feature"))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"args")," is used only with ",(0,i.kt)("a",{parentName:"p",href:"#ref"},"ref")," and allows to set additional positional args to referenced command. See ",(0,i.kt)("a",{parentName:"p",href:"#ref"},"ref")," example."))}u.isMDXComponent=!0}}]);